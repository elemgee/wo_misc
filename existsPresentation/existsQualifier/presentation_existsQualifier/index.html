<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make "Exists" qualifiers work for you</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/style.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress"><div class="step" step="0" data-x="0" data-y="0"><h1 id="make-exists-qualifiers-work-for-you">Make "Exists" qualifiers work for you</h1><p>created by Travis Cripps</p><p>demystified by Aaron Rosenzweig</p><p><a href="mailto:aaron@chatnbike.com">aaron@chatnbike.com</a></p><p>Codivus, Inc.</p></div><div class="step" step="1" data-x="1000" data-y="-1000"><h1 id="why-eof-is-cool">Why EOF is Cool:</h1><ul><li>We can think in Objects</li><li>These Objects know how to persist themselves</li><li>We get a proprietary query language which makes a Relational-DB feel like an Object-DB</li><li>Our query language works equally well against the Relational-DB or in Memory</li></ul></div><div class="step" step="2" data-x="2000" data-y="-2000" data-rotate-z="70"><h1 id="the-problem">The Problem:</h1><h2 id="to-many-relationships-are-hard">To-Many relationships are <em>hard!</em></h2></div><div class="step" step="3" data-x="3000" data-y="-3000" data-rotate-z="20"><h1 id="id1">The Problem:</h1><h2 id="id2">To-Many relationships are <em>hard!</em></h2><ul><li>Many SQL joins can be costly</li><li>Multiple to-many relationships in your combined qualifiers can cancel each other out.</li><li>bringing all objects into Java memory to perform your qualifier outside of SQL can work but it costs both RAM and speed.</li></ul></div><div class="step" step="4" data-x="4000" data-y="-4000" data-rotate-z="70"><h1 id="id3">The Problem:</h1><h2 id="to-one-relationships-can-be-slow">To-One relationships can be <em>slow!</em></h2><p>(sometimes)</p></div><div class="step" step="5" data-x="5000" data-y="-5000" data-rotate-z="20"><h1 id="id4">The Problem:</h1><h2 id="id5">To-One relationships can be <em>slow!</em></h2><p>(sometimes)</p><ul><li>When the tables involved in the join have lots of rows, an exists Qualifier can perform faster than an join</li></ul></div><div class="step" step="6" data-x="6000" data-y="-6000" data-rotate-z="70"><h1 id="the-solution">The Solution:</h1><h2 id="use-erxexistsqualifer">Use ERXExistsQualifer</h2><h2 id="with-codivus-improvements">(with Codivus improvements)</h2></div><div class="step" step="7" data-x="7000" data-y="-7000" data-rotate-z="20"><h1 id="erxexistsqualifier-improvements">ERXExistsQualifier Improvements:</h1><ul><li>Optionally convert "exists" to "in" qualifier</li><li>Handles complex inner qualifiers</li><li>Can work in-Memory</li><li>Can handle long keypaths</li><li>Misc. bug fixes</li></ul></div><div class="step" step="8" data-x="8000" data-y="-8000" data-rotate-z="70"><h1 id="simple-entity-model">Simple Entity Model</h1><ul><li>Company</li><li>Employee</li><li>Profession</li></ul></div><div class="step" step="9" data-x="9000" data-y="-9000" data-rotate-z="20"><h1 id="sample-data">Sample data</h1><ul><li>"Joe's Crab Shack" has one chef, a manager, and a waiter</li><li>"Code Mongers" has three computer scientists and one famous chef</li></ul></div><div class="step" step="10" data-x="10000" data-y="-10000" data-rotate-z="70"><h1 id="companies-with-a-chef-java">Companies with a chef (java)</h1><pre class="highlight code java"><span class="n">EOQualifier</span> <span class="n">qualifier</span> <span class="o">=</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">dot</span><span class="o">(</span><span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">)</span>
        <span class="o">.</span><span class="na">containsObject</span><span class="o">(</span><span class="n">Profession</span><span class="o">.</span><span class="na">chef</span><span class="o">(</span><span class="n">editingContext</span><span class="o">()));</span>

<span class="k">return</span> <span class="n">Company</span><span class="o">.</span><span class="na">fetchCompanies</span><span class="o">(</span><span class="n">editingContext</span><span class="o">(),</span>
                <span class="n">qualifier</span><span class="o">,</span> <span class="kc">null</span> <span class="cm">/*sortOrderings*/</span><span class="o">);</span></pre></div><div class="step" step="11" data-x="11000" data-y="-11000" data-rotate-z="20"><h1 id="companies-with-a-chef-sql">Companies with a chef (sql)</h1><pre class="highlight code sql"><span class="k">SELECT</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"NAME"</span>
<span class="k">FROM</span> <span class="ss">"COMPANY"</span> <span class="n">t0</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">"EMPLOYEE"</span> <span class="n">T1</span>
        <span class="k">ON</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span> <span class="o">=</span> <span class="n">T1</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span>
<span class="k">WHERE</span> <span class="n">T1</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000002</span></pre></div><div class="step" step="12" data-x="12000" data-y="-12000" data-rotate-z="70"><h1 id="companies-with-a-chef-sql-issues">Companies with a chef (sql) issues</h1><ul><li>If there are 7 chefs in a company, that company will be repeated seven times.</li><li>A "distinct" on your fetch will "fix" the problem. (hah!)</li><li>You should avoid "distinct" if you can. It slows things down and smells like you are doing something wrong.</li></ul></div><div class="step" step="13" data-x="13000" data-y="-13000" data-rotate-z="20"><h1 id="companies-with-a-chef-and-a-coder-java">Companies with a chef and a coder (java)</h1><pre class="highlight code java"><span class="n">EOQualifier</span> <span class="n">chefQualifier</span> <span class="o">=</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">dot</span><span class="o">(</span><span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">)</span>
        <span class="o">.</span><span class="na">containsObject</span><span class="o">(</span><span class="n">Profession</span><span class="o">.</span><span class="na">chef</span><span class="o">(</span><span class="n">editingContext</span><span class="o">()));</span>

<span class="n">EOQualifier</span> <span class="n">compSciQualifier</span> <span class="o">=</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">dot</span><span class="o">(</span><span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">)</span>
        <span class="o">.</span><span class="na">containsObject</span><span class="o">(</span><span class="n">Profession</span><span class="o">.</span><span class="na">computerScientist</span><span class="o">(</span><span class="n">editingContext</span><span class="o">()));</span>

<span class="n">EOQualifier</span> <span class="n">combinedQualifier</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">ERXAndQualifier</span><span class="o">(</span><span class="n">chefQualifier</span><span class="o">,</span> <span class="n">compSciQualifier</span><span class="o">);</span>

<span class="k">return</span> <span class="n">Company</span><span class="o">.</span><span class="na">fetchCompanies</span><span class="o">(</span>
        <span class="n">editingContext</span><span class="o">(),</span> <span class="n">combinedQualifier</span><span class="o">,</span> <span class="kc">null</span> <span class="cm">/*sortOrderings*/</span><span class="o">);</span></pre></div><div class="step" step="14" data-x="14000" data-y="-14000" data-rotate-z="70"><h1 id="companies-with-a-chef-and-a-coder-sql">Companies with a chef and a coder (sql)</h1><pre class="highlight code sql"><span class="k">SELECT</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"NAME"</span>
<span class="k">FROM</span> <span class="ss">"COMPANY"</span> <span class="n">t0</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">"EMPLOYEE"</span> <span class="n">T1</span>
        <span class="k">ON</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span> <span class="o">=</span> <span class="n">T1</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="n">T1</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000004</span> <span class="k">AND</span> <span class="n">T1</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000002</span><span class="p">)</span></pre></div><div class="step" step="15" data-x="15000" data-y="-15000" data-rotate-z="20"><h1 id="companies-with-a-chef-and-a-coder-sql-issues">Companies with a chef and a coder (sql) issues</h1><ul><li>This query will always return <em>zero</em> results.</li><li>An employee only has one profession, and that value can't be two things at once.</li></ul></div><div class="step" step="16" data-x="16000" data-y="-16000" data-rotate-z="70"><h1 id="companies-with-a-chef-and-a-coder-in-memory">Companies with a chef and a coder (In Memory)</h1><pre class="highlight code java"><span class="n">EOQualifier</span> <span class="n">chefQualifier</span> <span class="o">=</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">dot</span><span class="o">(</span><span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">)</span>
        <span class="o">.</span><span class="na">containsObject</span><span class="o">(</span><span class="n">Profession</span><span class="o">.</span><span class="na">chef</span><span class="o">(</span><span class="n">editingContext</span><span class="o">()));</span>

<span class="n">EOQualifier</span> <span class="n">compSciQualifier</span> <span class="o">=</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">dot</span><span class="o">(</span><span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">)</span>
        <span class="o">.</span><span class="na">containsObject</span><span class="o">(</span><span class="n">Profession</span><span class="o">.</span><span class="na">computerScientist</span><span class="o">(</span><span class="n">editingContext</span><span class="o">()));</span>

<span class="n">EOQualifier</span> <span class="n">combinedQualifier</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">ERXAndQualifier</span><span class="o">(</span><span class="n">chefQualifier</span><span class="o">,</span> <span class="n">compSciQualifier</span><span class="o">);</span>

<span class="k">return</span> <span class="n">ERXArrayUtilities</span><span class="o">.</span><span class="na">filteredArrayWithQualifierEvaluation</span><span class="o">(</span>
        <span class="n">allCompanies</span><span class="o">(),</span> <span class="n">combinedQualifier</span><span class="o">);</span></pre></div><div class="step" step="17" data-x="17000" data-y="-17000" data-rotate-z="20"><h1 id="companies-with-a-chef-and-a-coder-in-memory-issues">Companies with a chef and a coder (In Memory) issues</h1><ul><li>If there are 1 million companies in your data, do you really want to bring them all into your java app?</li><li>There has to be a better way! We have EOF, c'mon!</li></ul></div><div class="step" step="18" data-x="18000" data-y="-18000" data-rotate-z="70"><h1 id="never-forget">Never Forget</h1><ul><li>Apple's <em>OperatorContains</em> will always execute.</li><li>It gives one result for in-memory evaluation and a totally different (and incorrect) result for sql evaluation</li><li>This yields non-deterministic behavior</li><li>We should strive for qualifiers that work the same no matter where they are used.</li><li>11th commandment - thou shalt not use <em>OperatorContains</em></li></ul></div><div class="step" step="19" data-x="19000" data-y="-19000" data-rotate-z="20"><h1 id="never-forget-addendum">Never Forget (addendum)</h1><ul><li><em>OperatorContains</em> should not mean to do a "LIKE" comparison on character data</li><li>Some custom WO database plugins get this wrong, notably FrontBase</li><li>Modern Frontbase plugins can work with a property:</li></ul><pre class="highlight ">jdbcadaptor.frontbase.frontbaseContainsOperatorFix=true</pre></div><div class="step" step="20" data-x="20000" data-y="-20000" data-rotate-z="70"><h1 id="chef-and-a-coder-exists">Chef and a coder (<em>Exists</em>)</h1><pre class="highlight code java"><span class="n">EOQualifier</span> <span class="n">chefQualifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ERXExistsQualifier</span><span class="o">(</span>
        <span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">.</span><span class="na">is</span><span class="o">(</span>
          <span class="n">Profession</span><span class="o">.</span><span class="na">chef</span><span class="o">(</span><span class="n">editingContext</span><span class="o">()))</span> <span class="cm">/*subqualifier*/</span><span class="o">,</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">key</span><span class="o">()</span> <span class="cm">/*baseKeyPath*/</span><span class="o">);</span>

<span class="n">EOQualifier</span> <span class="n">compSciQualifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ERXExistsQualifier</span><span class="o">(</span>
        <span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">.</span><span class="na">is</span><span class="o">(</span>
          <span class="n">Profession</span><span class="o">.</span><span class="na">computerScientist</span><span class="o">(</span><span class="n">editingContext</span><span class="o">()))</span> <span class="cm">/*subqualifier*/</span><span class="o">,</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">key</span><span class="o">()</span> <span class="cm">/*baseKeyPath*/</span><span class="o">);</span>

<span class="n">EOQualifier</span> <span class="n">combinedQualifier</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">ERXAndQualifier</span><span class="o">(</span><span class="n">chefQualifier</span><span class="o">,</span> <span class="n">compSciQualifier</span><span class="o">);</span>
<span class="k">return</span> <span class="n">Company</span><span class="o">.</span><span class="na">fetchCompanies</span><span class="o">(</span>
        <span class="n">editingContext</span><span class="o">(),</span> <span class="n">combinedQualifier</span><span class="o">,</span> <span class="kc">null</span> <span class="cm">/*sortOrderings*/</span><span class="o">);</span></pre></div><div class="step" step="21" data-x="21000" data-y="-21000" data-rotate-z="20"><h1 id="chef-and-a-coder-exists-sql">Chef and a coder (<em>Exists</em> sql)</h1><pre class="highlight code sql"><span class="k">SELECT</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"NAME"</span>
<span class="k">FROM</span> <span class="ss">"COMPANY"</span> <span class="n">t0</span>
<span class="k">WHERE</span> <span class="p">(</span>
        <span class="k">EXISTS</span> <span class="p">(</span>
                <span class="k">SELECT</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"id"</span>
                <span class="k">FROM</span> <span class="ss">"EMPLOYEE"</span> <span class="n">exists0</span>
                <span class="k">WHERE</span>
                        <span class="n">exists0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000004</span> <span class="k">AND</span>
                        <span class="n">exists0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span>
        <span class="p">)</span>  <span class="k">AND</span>
        <span class="k">EXISTS</span> <span class="p">(</span>
                <span class="k">SELECT</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"id"</span>
                <span class="k">FROM</span> <span class="ss">"EMPLOYEE"</span> <span class="n">exists0</span>
                <span class="k">WHERE</span>
                        <span class="n">exists0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000002</span> <span class="k">AND</span>
                        <span class="n">exists0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span>
        <span class="p">)</span>
<span class="p">)</span></pre></div><div class="step" step="22" data-x="22000" data-y="-22000" data-rotate-z="70"><h1 id="chef-and-a-coder-exists-converted-to-in">Chef and a coder (<em>Exists</em> converted to "IN")</h1><pre class="highlight code java"><span class="n">EOQualifier</span> <span class="n">chefQualifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ERXExistsQualifier</span><span class="o">(</span>
        <span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">.</span><span class="na">is</span><span class="o">(</span>
          <span class="n">Profession</span><span class="o">.</span><span class="na">chef</span><span class="o">(</span><span class="n">editingContext</span><span class="o">()))</span> <span class="cm">/*subqualifier*/</span><span class="o">,</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">key</span><span class="o">()</span> <span class="cm">/*baseKeyPath*/</span><span class="o">,</span>
        <span class="kc">true</span> <span class="cm">/*usesInQualInstead*/</span><span class="o">);</span>

<span class="n">EOQualifier</span> <span class="n">compSciQualifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ERXExistsQualifier</span><span class="o">(</span>
        <span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">.</span><span class="na">is</span><span class="o">(</span>
          <span class="n">Profession</span><span class="o">.</span><span class="na">computerScientist</span><span class="o">(</span><span class="n">editingContext</span><span class="o">()))</span> <span class="cm">/*subqualifier*/</span><span class="o">,</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">key</span><span class="o">()</span> <span class="cm">/*baseKeyPath*/</span><span class="o">,</span>
        <span class="kc">true</span> <span class="cm">/*usesInQualInstead*/</span><span class="o">);</span>

<span class="n">EOQualifier</span> <span class="n">combinedQualifier</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">ERXAndQualifier</span><span class="o">(</span><span class="n">chefQualifier</span><span class="o">,</span> <span class="n">compSciQualifier</span><span class="o">);</span>
<span class="k">return</span> <span class="n">Company</span><span class="o">.</span><span class="na">fetchCompanies</span><span class="o">(</span>
        <span class="n">editingContext</span><span class="o">(),</span> <span class="n">combinedQualifier</span><span class="o">,</span> <span class="kc">null</span> <span class="cm">/*sortOrderings*/</span><span class="o">);</span></pre></div><div class="step" step="23" data-x="23000" data-y="-23000" data-rotate-z="20"><h1 id="chef-and-a-coder-exists-converted-to-in-sql">Chef and a coder (<em>Exists</em> converted to "IN" sql)</h1><pre class="highlight code sql"><span class="k">SELECT</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"NAME"</span>
<span class="k">FROM</span> <span class="ss">"COMPANY"</span> <span class="n">t0</span>
<span class="k">WHERE</span> <span class="p">(</span>
        <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span> <span class="k">IN</span> <span class="p">(</span>
                <span class="k">SELECT</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span>
                <span class="k">FROM</span> <span class="ss">"EMPLOYEE"</span> <span class="n">exists0</span>
                <span class="k">WHERE</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000004</span>
        <span class="p">)</span>  <span class="k">AND</span>
        <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span> <span class="k">IN</span> <span class="p">(</span>
                <span class="k">SELECT</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span>
                <span class="k">FROM</span> <span class="ss">"EMPLOYEE"</span> <span class="n">exists0</span>
                <span class="k">WHERE</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000002</span>
        <span class="p">)</span>
<span class="p">)</span></pre></div><div class="step" step="24" data-x="24000" data-y="-24000" data-rotate-z="70"><h1 id="which-is-better-exists-or-in">Which is better <em>Exists</em> or <em>In</em></h1><ul><li>The results are the same - performance could be different</li><li>Generally <em>Exists</em> will be faster but you must test</li><li>A good database will analyze and convert between <em>Exists</em> and <em>In</em> for you so in some sense it doesn't matter</li></ul></div><div class="step" step="25" data-x="25000" data-y="-25000" data-rotate-z="20"><h1 id="id6">Which is better <em>Exists</em> or <em>In</em></h1><ul><li>When the subquery result set is small, use an <em>In</em></li><li>When the outer result set is small, use an <em>Exists</em></li></ul></div><div class="step" step="26" data-x="26000" data-y="-26000" data-rotate-z="70"><h1 id="exists-explanation"><em>Exists</em> explanation</h1><p>This SQL</p><pre class="highlight code sql"><span class="k">SELECT</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"NAME"</span>
<span class="k">FROM</span> <span class="ss">"COMPANY"</span> <span class="n">t0</span> <span class="k">WHERE</span> <span class="k">EXISTS</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"id"</span>
        <span class="k">FROM</span> <span class="ss">"EMPLOYEE"</span> <span class="n">exists0</span>
        <span class="k">WHERE</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000002</span> <span class="k">AND</span>
                <span class="n">exists0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span> <span class="p">)</span></pre></div><div class="step" step="27" data-x="27000" data-y="-27000" data-rotate-z="20"><h1 id="id7"><em>Exists</em> explanation</h1><p>Is executed like:</p><pre class="highlight code sql"><span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="p">(</span> <span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"NAME"</span> <span class="k">from</span> <span class="ss">"COMPANY"</span> <span class="n">t0</span> <span class="p">)</span>
<span class="n">loop</span>
   <span class="n">if</span> <span class="p">(</span>
     <span class="k">exists</span> <span class="p">(</span>
     <span class="k">select</span> <span class="k">null</span> <span class="k">from</span> <span class="ss">"EMPLOYEE"</span> <span class="n">exists0</span>
     <span class="k">where</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000002</span> <span class="k">AND</span>
             <span class="n">exists0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span>
     <span class="p">)</span>
   <span class="p">)</span>
   <span class="k">then</span>
      <span class="k">OUTPUT</span> <span class="n">THE</span> <span class="n">RECORD</span>
   <span class="k">end</span> <span class="n">if</span>
<span class="k">end</span> <span class="n">loop</span></pre><p>It always results in a full scan of T0 (Company)</p></div><div class="step" step="28" data-x="28000" data-y="-28000" data-rotate-z="70"><h1 id="in-explanation"><em>In</em> explanation</h1><p>This SQL</p><pre class="highlight code sql"><span class="k">SELECT</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"NAME"</span>
<span class="k">FROM</span> <span class="ss">"COMPANY"</span> <span class="n">t0</span>
<span class="k">WHERE</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span> <span class="k">IN</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span>
        <span class="k">FROM</span> <span class="ss">"EMPLOYEE"</span> <span class="n">exists0</span>
        <span class="k">WHERE</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000002</span> <span class="p">)</span></pre></div><div class="step" step="29" data-x="29000" data-y="-29000" data-rotate-z="20"><h1 id="id8"><em>In</em> explanation</h1><p>Is executed like:</p><pre class="highlight code sql"><span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"NAME"</span>
<span class="k">FROM</span> <span class="ss">"COMPANY"</span> <span class="n">t0</span><span class="p">,</span>
        <span class="p">(</span>
                <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span>
                <span class="k">FROM</span> <span class="ss">"EMPLOYEE"</span> <span class="n">exists0</span>
                <span class="k">WHERE</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="mi">1000002</span>
        <span class="p">)</span> <span class="n">t1</span>
<span class="k">where</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span> <span class="o">=</span> <span class="n">t1</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span><span class="p">;</span></pre><p>This does a full table scan of exists0 (EMPLOYEE) as the subquery is evaluated, distinct'ed, indexed and then joined to the original table.</p></div><div class="step" step="30" data-x="30000" data-y="-30000" data-rotate-z="70"><h1 id="for-dave-avendasora">For Dave Avendasora</h1><p>An example with not only an EXISTS0 but also an EXISTS1 replacement. It happens when you have a complex subquery with one or more joins.</p></div><div class="step" step="31" data-x="31000" data-y="-31000" data-rotate-z="20"><h1 id="companies-with-chef-salary-between-20k-and-40k-java">Companies with chef salary between 20k and 40k (java)</h1><pre class="highlight code java"><span class="n">EOQualifier</span> <span class="n">qualifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ERXExistsQualifier</span><span class="o">(</span>
        <span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">.</span><span class="na">dot</span><span class="o">(</span><span class="n">Profession</span><span class="o">.</span><span class="na">NAME</span><span class="o">).</span><span class="na">is</span><span class="o">(</span><span class="s">"Chef"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">(</span>
        <span class="n">Employee</span><span class="o">.</span><span class="na">SALARY</span><span class="o">.</span><span class="na">greaterThanOrEqualTo</span><span class="o">(</span><span class="mi">20000</span><span class="o">))</span>
                <span class="o">.</span><span class="na">and</span><span class="o">(</span>
        <span class="n">Employee</span><span class="o">.</span><span class="na">SALARY</span><span class="o">.</span><span class="na">lessThanOrEqualTo</span><span class="o">(</span><span class="mi">40000</span><span class="o">))</span> <span class="cm">/*subqualifier*/</span><span class="o">,</span>
        <span class="n">Company</span><span class="o">.</span><span class="na">EMPLOYEES</span><span class="o">.</span><span class="na">key</span><span class="o">()</span> <span class="cm">/*baseKeyPath*/</span><span class="o">);</span>

<span class="k">return</span> <span class="n">Company</span><span class="o">.</span><span class="na">fetchCompanies</span><span class="o">(</span>
        <span class="n">editingContext</span><span class="o">(),</span> <span class="n">qualifier</span><span class="o">,</span> <span class="kc">null</span> <span class="cm">/*sortOrderings*/</span><span class="o">);</span></pre></div><div class="step" step="32" data-x="32000" data-y="-32000" data-rotate-z="70"><h1 id="companies-with-chef-salary-between-20k-and-40k-sql">Companies with chef salary between 20k and 40k (SQL)</h1><pre class="highlight code sql"><span class="k">SELECT</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"NAME"</span>
<span class="k">FROM</span> <span class="ss">"COMPANY"</span> <span class="n">t0</span>
<span class="k">WHERE</span> <span class="k">EXISTS</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"id"</span>
        <span class="k">FROM</span> <span class="ss">"EMPLOYEE"</span> <span class="n">exists0</span>
        <span class="k">INNER</span> <span class="k">JOIN</span> <span class="ss">"PROFESSION"</span> <span class="n">exists1</span> <span class="k">ON</span>
                <span class="n">exists0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="o">=</span> <span class="n">exists1</span><span class="p">.</span><span class="ss">"id"</span>
        <span class="k">WHERE</span> <span class="p">(</span>
                <span class="n">exists1</span><span class="p">.</span><span class="ss">"NAME"</span> <span class="o">=</span> <span class="s1">'Chef'</span> <span class="k">AND</span>
                <span class="n">exists0</span><span class="p">.</span><span class="ss">"salary"</span> <span class="o">&gt;=</span> <span class="mi">20000</span> <span class="k">AND</span>
                <span class="n">exists0</span><span class="p">.</span><span class="ss">"salary"</span> <span class="o">&lt;=</span> <span class="mi">40000</span>
        <span class="p">)</span>
        <span class="k">AND</span>
        <span class="n">exists0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span>
<span class="p">)</span></pre></div><div class="step" step="33" data-x="33000" data-y="-33000" data-rotate-z="20"><h1 id="a-to-one-relationship-example">A to-one relationship example</h1><p>9 times out of 10, regular joins will work just fine for to-one relationships. But, there are those odd times where the join is so painful that you will want to use an <em>Esists!</em> qualifier.</p></div><div class="step" step="34" data-x="34000" data-y="-34000" data-rotate-z="70"><h1 id="all-employees-that-are-chefs-java">All employees that are chefs (java)</h1><pre class="highlight code java"><span class="n">EOQualifier</span> <span class="n">qualifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ERXExistsQualifier</span><span class="o">(</span>
        <span class="n">Profession</span><span class="o">.</span><span class="na">NAME</span><span class="o">.</span><span class="na">is</span><span class="o">(</span><span class="s">"Chef"</span><span class="o">)</span> <span class="cm">/*subqualifier*/</span><span class="o">,</span>
        <span class="n">Employee</span><span class="o">.</span><span class="na">PROFESSION</span><span class="o">.</span><span class="na">key</span><span class="o">()</span> <span class="cm">/*baseKeyPath*/</span><span class="o">);</span>

<span class="k">return</span> <span class="n">Employee</span><span class="o">.</span><span class="na">fetchEmployees</span><span class="o">(</span>
        <span class="n">editingContext</span><span class="o">(),</span> <span class="n">qualifier</span><span class="o">,</span> <span class="kc">null</span> <span class="cm">/*sortOrderings*/</span><span class="o">);</span></pre></div><div class="step" step="35" data-x="35000" data-y="-35000" data-rotate-z="20"><h1 id="all-employees-that-are-chefs-sql">All employees that are chefs (SQL)</h1><pre class="highlight code sql"><span class="k">SELECT</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"COMPANY_ID"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"FIRST_NAME"</span><span class="p">,</span>
        <span class="n">t0</span><span class="p">.</span><span class="ss">"id"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"LAST_NAME"</span><span class="p">,</span>
        <span class="n">t0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"salary"</span>
<span class="k">FROM</span> <span class="ss">"EMPLOYEE"</span> <span class="n">t0</span>
<span class="k">WHERE</span>  <span class="k">EXISTS</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"id"</span>
        <span class="k">FROM</span> <span class="ss">"PROFESSION"</span> <span class="n">exists0</span>
        <span class="k">WHERE</span> <span class="n">exists0</span><span class="p">.</span><span class="ss">"NAME"</span> <span class="o">=</span> <span class="s1">'Chef'</span> <span class="k">AND</span>
        <span class="n">exists0</span><span class="p">.</span><span class="ss">"id"</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="ss">"PROFESSION_ID"</span> <span class="p">)</span></pre></div><div class="step" step="36" data-x="36000" data-y="-36000" data-rotate-z="70"><h1 id="real-life-example">Real life example!</h1><pre class="highlight code java"><span class="c1">// (Aaron Dec. 31, 2013)
// using a join is much slower than the "in" clause
// EOQualifier forQuestionQualifier = Answer.PLACED_QUESTION
//   .dot(PlacedQuestion.QUESTION).is(forQuestion);
</span>
<span class="n">EOQualifier</span> <span class="n">forQuestionQualifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ERXExistsQualifier</span><span class="o">(</span>
        <span class="n">PlacedQuestion</span><span class="o">.</span><span class="na">QUESTION</span><span class="o">.</span><span class="na">is</span><span class="o">(</span><span class="n">forQuestion</span><span class="o">),</span>
        <span class="n">Answer</span><span class="o">.</span><span class="na">PLACED_QUESTION</span><span class="o">.</span><span class="na">key</span><span class="o">(),</span> <span class="kc">true</span> <span class="cm">/*usesInQualInstead*/</span><span class="o">);</span>

<span class="o">*</span> <span class="s">"Answer"</span> <span class="n">table</span> <span class="n">has</span> <span class="mi">19</span><span class="o">,</span><span class="mi">353</span><span class="o">,</span><span class="mi">992</span> <span class="n">rows</span>
<span class="o">*</span> <span class="s">"PlacedQuestion"</span> <span class="n">table</span> <span class="n">has</span> <span class="mi">27</span><span class="o">,</span><span class="mi">202</span> <span class="n">rows</span>
<span class="o">*</span> <span class="s">"Question"</span> <span class="n">table</span> <span class="n">has</span> <span class="mi">2</span><span class="o">,</span><span class="mi">307</span> <span class="n">rows</span></pre></div><div class="step" step="37" data-x="37000" data-y="-37000" data-rotate-z="20"><h1 id="good-to-know">Good to Know:</h1><ul><li>For to-many relationships, <em>Exists</em> is your friend</li><li>For slow to-one relationships, <em>Exists</em> can help too</li></ul></div><div class="step" step="38" data-x="38000" data-y="-38000" data-rotate-z="70"><h1 id="mantra">Mantra:</h1><p>When you think you're stuck...</p><p><em>Exists!</em> will dig you out.</p></div><div class="step" step="39" data-x="39000" data-y="-39000" data-rotate-z="20"><h1 id="corollary">Corollary:</h1><p><em>Exists!</em> solves many problems but there may come a time you need something else.</p><p><em>Exists!</em> will give you a template to make your own qualifier.</p><p>The Houdah frameworks are also quite good.</p></div><div class="step" step="40" data-x="40000" data-y="-40000" data-rotate-z="70"><h1 id="if-it-is-too-painful">If it is too painful:</h1><p>Consider using a pure object Database.</p><p>It might just be for the really tricky part of your business logic that you use an OODB.</p></div><div class="step" step="41" data-x="41000" data-y="-41000" data-rotate-z="20"><h1 id="please-take-our-pull-request">Please take our pull request</h1><ul><li><a href="https://github.com/wocommunity/wonder/pull/541">https://github.com/wocommunity/wonder/pull/541</a></li><li><a href="https://github.com/recurve/wo_misc">https://github.com/recurve/wo_misc</a></li><li><a href="http://www.chatnbike.com/presentation_existsQualifier">http://www.chatnbike.com/presentation_existsQualifier</a></li><li><a href="http://www.chatnbike.com/presentation_existsQualifier/exists_app_example_screen/">http://www.chatnbike.com/presentation_existsQualifier/exists_app_example_screen/</a></li></ul></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script><div id="logo_left"></div><div id="logo_right"></div></body></html>